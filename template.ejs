<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8" />
	<title>SandBoxBoard</title>
</head>

<body>
	<h1>SandBoxBoard</h1>
	<p>誰でも自由に編集や削除ができる匿名掲示板です。</p>
	<button id=load_before>前の20件を表示</button>
	<button id=load_before_all>すべてのコメントを表示</button>
	<a href=#latest>一番下へ行く</a>
	<ul id=comments>
	    <%- comments %>
	</ul>
	<a name=latest>
	<form method="post" action="/send">
		<input placeholder="名前" name="name"
		    <% if(name !== undefined){ %>
		        value="<%= name %>"
		    <% } %>
		/>
		<input placeholder="コメント" name="content" id="content" />
		<button>送信</button>
	</form>
	</a>
	<script>
		let startId = <%= startid %>;
		let endId = <%= endid %>;
		document.getElementById("load_before").onclick = () => {
			const http = new XMLHttpRequest();
			http.open("get", "/comments?lastid=" + startId);
			http.send();
			http.onreadystatechange = () => {
				if (http.readyState == 4 && http.status == 200) {
					const place = document.getElementById("comments");
					res = JSON.parse(http.responseText);
					place.innerHTML = res.html + place.innerHTML;
					//window.location.hash = startId.toString();
					startId = res.startid;
				}
			};
		};
		document.getElementById("load_before_all").onclick = () => {
			const http = new XMLHttpRequest();
			http.open("get", "/comments?count=-1&lastid=" + startId);
			http.send();
			http.onreadystatechange = () => {
				if (http.readyState == 4 && http.status == 200) {
					const place = document.getElementById("comments");
					res = JSON.parse(http.responseText);
					place.innerHTML = res.html + place.innerHTML;
					//window.location.hash = startId.toString();
					startId = res.startid;
				}
			};
		};
		setInterval(() => {
			const http = new XMLHttpRequest();
			http.open("get", "/comments?count=-1&startid=" + endId);
			http.send();
			http.onreadystatechange = () => {
				if (http.readyState == 4 && http.status == 200) {
					const place = document.getElementById("comments");
					res = JSON.parse(http.responseText);
					place.innerHTML = place.innerHTML + res.html;
					//window.location.hash = startId.toString();
					endId = res.endid;
				}
			};			
		}, 10000);
	<% if(focus !== undefined){ %>
	    document.body.onload = () => {document.getElementById("content").focus();};
    <% } %>
    </script>
</body>

</html>
