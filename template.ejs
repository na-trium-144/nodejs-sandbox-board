<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8" />
	<title>SandBoxBoard</title>
</head>

<body>
	<h1>SandBoxBoard</h1>
	<p>誰でも自由に編集や削除ができる匿名掲示板です。</p>
	<button id=load_before>前の50件を読み込む</button>
	<a href=#latest>一番下へ行く</a>
	<ul id=comments>
		<% for (const book of books) { %>
		<li>
		    <a name=<%= book.id %>>
			<form action="/edit">
				<b>
					<% if(book.name === ""){ %>
						名無し
					<% }else{ %>
						<%= book.name %>
					<% } %>
				:</b>
				<%= book.content %>
				<i style="color:gray">(
					<% if(book.edited){ %>
						編集済み:
					<% } %>
					<script>document.write(new Date("<%= book.time.toJSON() %>").toLocaleString());</script>
				)</i>
				<input type="hidden" name="id" value="<%= book.id %>">
				<button>編集</button>
			</form>
			</a>
		</li>
		<% } %>
	</ul>
	<a name=latest>
	<form method="post" action="/send">
		<input placeholder="名前" name="name"
		    <% if(name !== undefined){ %>
		        value="<%= name %>"
		    <% } %>
		/>
		<input placeholder="コメント" name="content" id="content" />
		<button>送信</button>
	</form>
	</a>
	<script>
		let startId = <%= books[0].id %>;
		document.getElementById("load_before").onclick = () => {
			const http = new XMLHttpRequest();
			http.open("get", "/comments?lastid=" + startId);
			http.send();
			http.onreadystatechange = () => {
				if (http.readyState == 4 && http.status == 200) {
					const place = document.getElementById("comments");
					place.innerHTML = http.responseText + place.innerHTML;
				}
			};
		};
	<% if(focus !== undefined){ %>
	    document.body.onload = () => {document.getElementById("content").focus();};
    <% } %>
    </script>
</body>

</html>
